{% extends "parent.html.j2" %}
{% block head %}
    <title>Home</title>
{% endblock %}
  
{% block nav %}		
  <span class="navbar-text">

  <div class="dropdown custom-dropdown">
        <a onclick="dropDownFunc()" class="" href="#">Select Filters</a>
        <div id="filtersList" class="dropdown-content">
          <form action="{{ url_for('index') }}">
            <p>Location</p> 
            <input type="text" name="location"  placeholder="Any">
            <p>Maximum price</p> 
            <input type="number" name="maxprice" placeholder="max">
            <p>Availability</p> 
            start<input type="date" name='startdate'>
            <p></p>
            end<input type="date" name='enddate'>
            <p>Amenities</p> 
            <span>Wifi<input type="checkbox" name="amenity1" value='wifi'></span><span>Electricity<input type="checkbox" name="amenity2" value='electricity' ></span>
            <p></p>
            <span>Gym<input type="checkbox" name="amenity3" value='gym'></span><span>Security<input type="checkbox" name="amenity4" value='security'></span>
            <p></p>
            <span>AirCon<input type="checkbox" name="amenity5" value='airconditioner'></span><span>Study room<input type="checkbox" name="amenity6" value='studyroom'></span>
            <p></p>
            <input type="submit" value="Apply Filters">
          </form>
        </div>
      </div>
   
  </span>
 
{% endblock %}

{% block content %}
<a href="{{ url_for('index' ) }}">Clear Filters</a>
<div id="searchBoxDiv">
   <input type="text" placeholder="Type keyword" id="searchBox" onkeyup="searchFunc()">
   <p style='text-align:center; color:{{color}}'>{{msg}}</p>
</div>

  
  <!-- section -->
  <div class="container-fluid">
    <div class="row">
      <!-- Image Row -->

      {% for home in homes %}
        <div class="home-box col-lg-3 col-md-4 col-sm-6 col-xs-12 homediv">
          <div class="thumbnail">
            <a href="/view_home/{{ home.get('homeId')}} " style="text-decoration: none">
              <img src="{{home.get('homeimgs')[0]}}" alt="Lights" style="width:100%; height: 250px; border-radius: 20px; margin-bottom: 5%">
            </a>
            <div class="caption" id="homecaption">
              <p>{{home.get('homename')}}</p>
              <p>{{home.get('homeaddress')}}, {{home.get('city')}}, {{home.get('country')}}</p>
              <p>{{home.get('roomprice')}} / month / room</p>
            </div>
          </div>
        </div> 
      {% endfor %}
      
    </div>
  </div>
{% endblock %}

{%block script%}
<script>
function dropDownFunc() {
    document.getElementById("filtersList").classList.toggle("show");
  }
</script>

<script>

//TODO: Fix bug - The nice line by line display is destroyed after a search
function searchFunc() {
    var searchVal, p, i;
    searchVal = document.getElementById("searchBox").value.toUpperCase();
    homediv = document.querySelectorAll(".homediv"); 

    for (let j = 0; j < homediv.length; j++) {

      p = homediv[j].querySelectorAll(".caption")
      for (i = 0; i < p.length; i++) {

        txtValue = p[i].textContent || p[i].innerText;
        index = txtValue.toUpperCase().indexOf(searchVal)

        if (index > -1) {
          homediv[j].style.display = "";
          newInnerText = txtValue.substring(0,index) + "<span class='highlight'>" + txtValue.substring(index,index+searchVal.length) + "</span>" + txtValue.substring(index + searchVal.length);
          p[i].innerHTML = "<p>" + newInnerText + "</p>"
          break;

        } else {

          homediv[j].style.display = "none";
        }
    }

    }
  }



</script>

{%endblock%}
